<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global 10-Finger Academy Pro</title>
<style>
  :root { 
    --primary: #3498db; --secondary: #2c3e50; --bg: #f4f7f6;
    --f1: #ff7675; --f2: #fab1a0; --f3: #ffeaa7; --f4: #55efc4; 
    --f5: #81ecec; --f6: #74b9ff; --f7: #a29bfe; --f8: #fd79a8;
  }
  body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
  .container { max-width: 1200px; margin: auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
  
  .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
  .tab-btn { padding: 12px 25px; border: none; border-radius: 10px 10px 0 0; cursor: pointer; font-weight: bold; background: #e0e0e0; transition: 0.3s; }
  .tab-btn.active { background: var(--primary); color: white; }

  .content-section { display: none; }
  .content-section.active { display: block; }

  .stats-bar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; background: var(--secondary); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center; }
  .stat-label { font-size: 0.8rem; text-transform: uppercase; opacity: 0.8; }
  .stat-value { font-size: 1.8rem; font-weight: bold; display: block; }

  #display { 
    background: #1e1e1e; color: #fff; padding: 30px; border-radius: 15px; font-size: 26px;
    font-family: 'Courier New', monospace; height: 180px; overflow-y: auto; line-height: 1.6; margin-bottom: 20px;
    border: 3px solid #333; position: relative;
  }
  .char.typed { color: #888; } 
  .char.current { border-bottom: 4px solid var(--primary); background: #333; }
  .char.correct { color: #2ecc71 !important; }
  .char.incorrect { color: #e74c3c !important; background: rgba(231, 76, 60, 0.2); }

  .keyboard { background: #2d3436; padding: 20px; border-radius: 15px; display: flex; flex-direction: column; gap: 8px; }
  .row { display: flex; justify-content: center; gap: 6px; }
  .key { width: 46px; height: 46px; background: #fff; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; border-bottom: 4px solid #bdc3c7; }
  .key.active { transform: translateY(4px); border-bottom: none; background: var(--primary) !important; color: white; }
  
  /* Finger-Farben */
  .f1 { border-color: var(--f1); } .f2 { border-color: var(--f2); } .f3 { border-color: var(--f3); } .f4 { border-color: var(--f4); }
  .f5 { border-color: var(--f5); } .f6 { border-color: var(--f6); } .f7 { border-color: var(--f7); } .f8 { border-color: var(--f8); }

  #resultModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 40px; border-radius: 20px; box-shadow: 0 0 100px rgba(0,0,0,0.5); z-index: 100; text-align: center; width: 400px; }
  #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 90; }
  #input-trigger { position: absolute; opacity: 0; pointer-events: none; }
  
  .mode-info { padding: 10px; background: #eee; border-radius: 8px; margin-bottom: 15px; font-weight: bold; color: var(--secondary); }
</style>
</head>
<body onclick="document.getElementById('input-trigger').focus()">

<div id="overlay"></div>
<div id="resultModal">
  <h2 id="modalTitle">Training beendet!</h2>
  <div style="font-size: 1.1rem; margin: 20px 0; text-align: left;">
    <p>Geschwindigkeit: <strong id="resWpm" style="color:var(--primary)"></strong> WPM</p>
    <p>Fehler: <strong id="resErrs" style="color:var(--error)"></strong></p>
    <p>Genauigkeit: <strong id="resAcc"></strong>%</p>
  </div>
  <button onclick="closeModal()" style="padding: 12px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">OK</button>
</div>

<div class="container">
  <div class="tabs">
    <button class="tab-btn active" id="tabTrainer" onclick="setMode('trainer')">Übungs-Trainer</button>
    <button class="tab-btn" id="tabLearn" onclick="setMode('learn')">Lern-Modus</button>
  </div>

  <div class="mode-info" id="modeIndicator">Modus: Übungs-Trainer (Fehler werden erst am Ende angezeigt)</div>

  <div class="stats-bar">
    <div><span class="stat-label">WPM</span><span class="stat-value" id="wpm">0</span></div>
    <div><span class="stat-label">Zeit / Limit</span><span class="stat-value" id="clock">--</span></div>
    <div><span class="stat-label">Fehler</span><span class="stat-value" id="errCount">0</span></div>
  </div>

  <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; background: #eee; padding: 15px; border-radius: 12px;">
    <select id="selLang" onchange="initGame()">
      <option value="de">Deutsch</option>
      <option value="es">Spanisch</option>
      <option value="pt">Portugiesisch</option>
      <option value="fi">Finnisch</option>
      <option value="da">Dänisch</option>
      <option value="no">Norwegisch</option>
      <option value="ru">Russisch</option>
      <option value="en">Englisch</option>
    </select>
    <select id="selLen" onchange="initGame()"></select>
    <select id="selTime" onchange="initGame()"></select>
    <button onclick="initGame()" style="background:var(--secondary); color:white; border:none; padding:8px 15px; border-radius: 5px; cursor:pointer; margin-left:auto;">Neustart</button>
  </div>

  <div id="display"></div>
  <input type="text" id="input-trigger" autocomplete="off">
  <div class="keyboard" id="kb"></div>
</div>

<script>
const words = {
  de: ["Haus", "Garten", "Schule", "Lernen", "Tastatur", "Computer", "Mensch", "Arbeit", "Leben", "Zeit"],
  es: ["casa", "jardín", "escuela", "aprender", "teclado", "computadora", "persona", "trabajo", "vida", "tiempo"],
  pt: ["casa", "jardim", "escola", "aprender", "teclado", "computador", "pessoa", "trabalho", "vida", "tempo"],
  fi: ["talo", "puutarha", "koulu", "oppiminen", "näppäimistö", "tietokone", "ihminen", "työ", "elämä", "aika"],
  da: ["hus", "have", "skole", "læring", "tastatur", "computer", "menneske", "arbejde", "liv", "tid"],
  no: ["hus", "hage", "skole", "læring", "tastatur", "datamaskin", "menneske", "arbeid", "liv", "tid"],
  ru: ["дом", "сад", "школа", "учеба", "клавиатура", "компьютер", "человек", "работа", "жизнь", "время"],
  en: ["house", "garden", "school", "learning", "keyboard", "computer", "people", "work", "life", "time"]
};

const layouts = {
  de: [["^","1","2","3","4","5","6","7","8","9","0","ß"],["Q","W","E","R","T","Z","U","I","O","P","Ü"],["A","S","D","F","G","H","J","K","L","Ö","Ä"],["<","Y","X","C","V","B","N","M",",",".","-"]],
  ru: [["Ё","1","2","3","4","5","6","7","8","9","0","-"],["Й","Ц","У","К","Е","Н","Г","Ш","Щ","З","Х","Ъ"],["Ф","Ы","В","А","П","Р","О","Л","Д","Ж","Э"],["Я","Ч","С","М","И","Т","Ь","Б","Ю","."]]
};

const fingerMap = {
  "Q":"f1","A":"f1","Y":"f1","Z":"f1","1":"f1","W":"f2","S":"f2","X":"f2","2":"f2","E":"f3","D":"f3","C":"f3","3":"f3","R":"f4","F":"f4","V":"f4","4":"f4","T":"f4","G":"f4","B":"f4","5":"f4",
  "6":"f5","7":"f5","Y":"f5","H":"f5","N":"f5","U":"f5","J":"f5","M":"f5","8":"f6","I":"f6","K":"f6",",":"f6","9":"f7","O":"f7","L":"f7",".":"f7","0":"f8","P":"f8","Ö":"f8","Ä":"f8","Ü":"f8","ß":"f8"
};

let currentText = "", idx = 0, timerActive = false, startTime = null, clockInt = null, userInput = "";
let currentMode = 'trainer'; // 'trainer' oder 'learn'
let errorsInLearnMode = 0;

// Setup Dropdowns
const slen = document.getElementById('selLen');
for(let i=100; i<=1000; i+=100) { let o=document.createElement('option'); o.value=i; o.text=i+" Zeichen"; slen.add(o); }
const stime = document.getElementById('selTime');
for(let i=1; i<=20; i++) { let o=document.createElement('option'); o.value=i*60; o.text=i+" Min."; stime.add(o); }

function setMode(mode) {
  currentMode = mode;
  document.getElementById('tabTrainer').classList.toggle('active', mode === 'trainer');
  document.getElementById('tabLearn').classList.toggle('active', mode === 'learn');
  document.getElementById('modeIndicator').innerText = mode === 'trainer' ? 
    "Modus: Übungs-Trainer (Fehler werden erst am Ende angezeigt)" : 
    "Modus: Lern-Modus (Fehler werden sofort ROT markiert, kein Zeitlimit)";
  initGame();
}

function initGame() {
  const lang = document.getElementById('selLang').value;
  const len = parseInt(document.getElementById('selLen').value);
  
  currentText = "";
  const pool = words[lang] || words['de'];
  while(currentText.length < len) { currentText += pool[Math.floor(Math.random()*pool.length)] + " "; }
  currentText = currentText.trim().substring(0, len);
  
  idx = 0; userInput = ""; timerActive = false; errorsInLearnMode = 0;
  clearInterval(clockInt);
  
  document.getElementById('clock').innerText = currentMode === 'trainer' ? document.getElementById('selTime').value : "∞";
  document.getElementById('wpm').innerText = "0";
  document.getElementById('errCount').innerText = "0";
  document.getElementById('input-trigger').value = "";
  document.getElementById('input-trigger').disabled = false;
  
  renderKeyboard(lang);
  renderDisplay();
}

function renderKeyboard(lang) {
  const kb = document.getElementById('kb'); kb.innerHTML = "";
  const layout = layouts[lang] || layouts['de'];
  layout.forEach(row => {
    const rDiv = document.createElement('div'); rDiv.className = "row";
    row.forEach(k => {
      const kd = document.createElement('div'); kd.className = `key ${fingerMap[k.toUpperCase()] || ''}`;
      kd.id = `k-${k.toUpperCase()}`; kd.innerText = k; rDiv.appendChild(kd);
    });
    kb.appendChild(rDiv);
  });
  const sRow = document.createElement('div'); sRow.className = "row";
  sRow.innerHTML = `<div class="key" id="k- " style="width:380px">LEERTASTE</div>`;
  kb.appendChild(sRow);
}

function renderDisplay() {
  const d = document.getElementById('display');
  d.innerHTML = currentText.split('').map((c, i) => `<span class="char ${i===0?'current':''}">${c}</span>`).join('');
  highlightKey();
}

function highlightKey() {
  document.querySelectorAll('.key').forEach(k => k.classList.remove('active'));
  const next = currentText[idx]?.toUpperCase();
  const kElement = document.getElementById(`k-${next === ' ' ? ' ' : next}`);
  if(kElement) kElement.classList.add('active');
}

document.getElementById('input-trigger').addEventListener('input', (e) => {
  if(!timerActive && currentMode === 'trainer') { 
    timerActive = true; 
    startTime = new Date(); 
    startClock(); 
  } else if (!timerActive && currentMode === 'learn') {
    timerActive = true;
    startTime = new Date();
  }
  
  userInput = e.target.value;
  const chars = document.querySelectorAll('.char');
  
  if(currentMode === 'learn') {
    // SOFORT-FEEDBACK IM LERNMODUS
    const lastCharIdx = userInput.length - 1;
    if(userInput[lastCharIdx] === currentText[lastCharIdx]) {
      chars[lastCharIdx].classList.add('correct');
      chars[lastCharIdx].classList.remove('incorrect');
    } else {
      chars[lastCharIdx].classList.add('incorrect');
      chars[lastCharIdx].classList.remove('correct');
      errorsInLearnMode++;
      document.getElementById('errCount').innerText = errorsInLearnMode;
    }
  }
  
  idx = userInput.length;
  chars.forEach((c, i) => {
    c.classList.remove('current');
    if(currentMode === 'trainer' && i < idx) c.classList.add('typed');
    if(i === idx) c.classList.add('current');
  });

  if(idx >= currentText.length) finishGame();
  else {
    chars[idx].scrollIntoView({ block: 'center' });
    highlightKey();
  }
  updateWPMDisplay();
});

function startClock() {
  let time = parseInt(document.getElementById('selTime').value);
  clockInt = setInterval(() => {
    time--; document.getElementById('clock').innerText = time;
    if(time <= 0) finishGame();
  }, 1000);
}

function updateWPMDisplay() {
  const elapsed = (new Date() - startTime) / 60000;
  const wpm = Math.round((idx / 5) / elapsed) || 0;
  document.getElementById('wpm').innerText = wpm;
}

function finishGame() {
  clearInterval(clockInt);
  document.getElementById('input-trigger').disabled = true;
  
  let errors = 0;
  if(currentMode === 'trainer') {
    const chars = document.querySelectorAll('.char');
    for(let i=0; i < idx; i++) {
      if(userInput[i] === currentText[i]) chars[i].classList.add('correct');
      else { chars[i].classList.add('incorrect'); errors++; }
    }
  } else {
    errors = errorsInLearnMode;
  }

  document.getElementById('modalTitle').innerText = currentMode === 'trainer' ? "Training beendet!" : "Lektion abgeschlossen!";
  document.getElementById('resWpm').innerText = document.getElementById('wpm').innerText;
  document.getElementById('resErrs').innerText = errors;
  document.getElementById('resAcc').innerText = Math.round(((idx - errors) / idx) * 100) || 0;
  document.getElementById('overlay').style.display = 'block';
  document.getElementById('resultModal').style.display = 'block';
}

function closeModal() {
  document.getElementById('overlay').style.display = 'none';
  document.getElementById('resultModal').style.display = 'none';
}

initGame();
</script>
</body>
</html>
